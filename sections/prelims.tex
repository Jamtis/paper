% !TEX root = ../paper.tex
\section{Preliminaries}
\label{sec:prelims}

\begin{definition}
    An admissible space \(A \coloneqq \parr{A_\secpar}_{\secpar \in \N}\) is a family of sets \(A_\secpar\) that are efficiently samplable and membership is efficiently decidable.
\end{definition}

\begin{definition}[Tag-Puncturable KEM]
    An \(\parr{\alpha,\alpha_{\textsf{PK}},\alpha_{\textsf{DE}},\varepsilon}\)-tag-puncturable KEM (tpKEM) is a tuple \(\parr{\Gen,\Enc,\Dec,\Punct}\) associated with
    an admissible key space \(K \coloneqq \parr{K_\secpar}_{\secpar \in \N}\),
    an admissible tag space \(T \coloneqq \parr{T_\secpar}_{\secpar \in \N}\) and
    an admissible randomness space \(R \coloneqq \parr{R_\secpar}_{\secpar \in \N}\) such that
    \begin{sitemize}
        \item \(\Gen\) on input \(1^\secpar\) generates a pair \(\parr{\pk,\sk}\),
        \item \(\Enc\) on input a public key \(\pk\) and a tag \(t \in T_\secpar\) outputs a ciphertext \(c\) and the encapsulated key \(\kappa \in K_\secpar \cup \parc{\bot}\),
        \item \(\Dec\) on input a secret key \(\sk\) and a ciphertext \(c\) outputs the encapsulated key \(\kappa \in K_\secpar \cup \parc{\bot}\),
        \item \(\Punct\) on input a secret key \(\sk\) and a tag \(t \in T_\secpar\) outputs a punctured secret key \(\sk\pars{t}\) that is able to decrypt (almost) all ciphertexts except those with tag \(t \in T_\secpar\).
    \end{sitemize}
    For each security parameter \(\secpar \in \N\),
    each message \(m \in M_\secpar\),
    each randomness \(r' \in R_\secpar\),
    and each tags \(t \neq t' \in T_\secpar\) we require the following correctness properties:
    \begin{sitemize}
        \item Decapsulation correctness:
        \begin{bralign}
            \Pr{
                \parr{\pk,\sk} \gets \Gen\parr{1^\secpar},
                c \gets \Enc\parr{\pk,m,t}
                :
                \Dec\parr{\sk,c} = m
            }
            \geq 1 - \alpha\parr{\secpar}
        \end{bralign}

        \item Punctured key correctness:
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    \sk\pars{t'} &\gets \Punct\parr{\sk,t'}
                    \\
                    c &\gets \Enc\parr{\pk,t}
                \end{array}
                :
                \Dec\parr{\sk\pars{t'},c} = \Dec\parr{\sk,c}
            }
            \geq 1 - \alpha_{\textsf{PK}}\parr{\secpar}
            \ ,
        \end{bralign}

        \item zero-sided decryption error on punctured key:
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    \sk\pars{t'} &\gets \Punct\parr{\sk,t'}
                    \\
                    c &\gets \Enc\parr{\pk,t'}
                \end{array}
                :
                \Dec\parr{\sk\pars{t'},c} = \bot
            }
            \geq 1 - \alpha_{\textsf{DE}}\parr{\secpar}
            \ ,
        \end{bralign}
    \end{sitemize}
    Furthermore we say a tpKEM is
    \begin{sitemize}
        \item selectively indistinguishable under chosen tag key leakage (sel-IND-CTKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    t^* &\coloneqq \A_1\parr{1^\secpar; r_\A}
                    \\
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    b &\gets \bit
                    \\
                    \sk\pars{t^*} &\gets \Punct\parr{\sk,t^*}
                    \\
                    c_0 &\gets \Enc\parr{\pk,t^*}
                    \\
                    c_1 &\gets K_\secpar
                    \\
                    b' &\coloneqq \A_2\parr{\pk,c_b,\sk\pars{t^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
            \ ,
        \end{bralign}

        \item adaptively indistinguishable under chosen plainttext attack with chosen tag key leakage (ad-IND-CPA/CTKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    t^* &\gets \A_1\parr{\pk;r_\A}
                    \\
                    b &\gets \bit
                    \\
                    \sk\pars{t^*} &\gets \Punct\parr{\sk,t^*}
                    \\
                    c_0 &\gets \Enc\parr{\pk,t^*}
                    \\
                    c_1 &\gets K_\secpar
                    \\
                    b' &\coloneqq \A_2\parr{\pk,c_b,\sk\pars{t^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
            \ ,
        \end{bralign}

        \item adaptively indistinguishable under chosen ciphertext attack with chosen tag key leakage (ad-IND-CCA/CTKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    t^* &\gets \A_1^{\Dec\parr{\sk,\cdot}}\parr{\pk;r_\A}
                    \\
                    b &\gets \bit
                    \\
                    \sk\pars{t^*} &\gets \Punct\parr{\sk,t^*}
                    \\
                    c_0 &\gets \Enc\parr{\pk,t^*}
                    \\
                    c_1 &\gets K_\secpar
                    \\
                    b' &\coloneqq \A_2^{\Dec\parr{\sk,\cdot}}\parr{\pk,c_b,\sk\pars{t^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
        \end{bralign}
        where the decryption oracle outputs \(\bot\) on \(c_b\),
    \end{sitemize}
    for any efficient two-stage adversary \(\A = \parr{\A_1, \A_2}\) and some negligible function \(\negl\).
\end{definition}

\begin{definition}[Tag-Puncturable PKE]
    An \(\parr{\alpha,\alpha_{\textsf{PK}},\alpha_{\textsf{DE}},\varepsilon}\)-tag-puncturable PKE (tpPKE) is a tuple \(\parr{\Gen,\Enc,\Dec,\Punct}\) associated with an admissible message space \(M \coloneqq \parr{M_\secpar}_{\secpar \in \N}\),
    an admissible tag space \(T \coloneqq \parr{T_\secpar}_{\secpar \in \N}\) and
    an admissible randomness space \(R \coloneqq \parr{R_\secpar}_{\secpar \in \N}\) such that
    \begin{sitemize}
        \item \(\Gen\) on input \(1^\secpar\) generates a pair \(\parr{\pk,\sk}\),
        \item \(\Enc\) on input a public key \(\pk\), a message \(m \in M_\secpar\) and a tag \(t \in T_\secpar\) outputs a ciphertext \(c\),
        \item \(\Dec\) on input a secret key \(\sk\) and a ciphertext \(c\) outputs the encrypted message \(m \in M_\secpar \cup \parc{\bot}\),
        \item \(\Punct\) on input a secret key \(\sk\) and a tag \(t \in T_\secpar\) outputs a punctured secret key \(\sk\pars{t}\) that is able to decrypt (almost) all ciphertexts except those with tag \(t \in T_\secpar\).
    \end{sitemize}
    For each security parameter \(\secpar \in \N\),
    each message \(m \in M_\secpar\),
    and each tags \(t \neq t' \in T_\secpar\) we require the following correctness properties:
    \begin{sitemize}
        \item Message correctness:
        \begin{bralign}
            \Pr{
                \parr{\pk,\sk} \gets \Gen\parr{1^\secpar},
                c \gets \Enc\parr{\pk,m,t}
                :
                \Dec\parr{\sk,c} = m
            }
            \geq 1 - \alpha\parr{\secpar}
        \end{bralign}

        \item Punctured key correctness:
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    \sk\pars{t'} &\gets \Punct\parr{\sk,t'}
                    \\
                    c &\gets \Enc\parr{\pk,m,t}
                \end{array}
                :
                \Dec\parr{\sk\pars{t'},c} = m
            }
            \geq 1 - \alpha_{\textsf{PK}}\parr{\secpar}
        \end{bralign}

        \item zero-sided decryption error on punctured key:
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    \sk\pars{t'} &\gets \Punct\parr{\sk,t'}
                    \\
                    c &\gets \Enc\parr{\pk,m,t'}
                \end{array}
                :
                \Dec\parr{\sk\pars{t'},c} = \bot
            }
            \geq 1 - \alpha_{\textsf{DE}}\parr{\secpar}
        \end{bralign}
        \marginnote{Statistical variant analogous}
    \end{sitemize}
    Furthermore we say a tpPKE is
    \begin{sitemize}
        \item selectively indistinguishable under chosen plaintext attack with chosen tag key leakage (sel-IND-CPA/CTKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{m^0,m^1,t^*} &\coloneqq \A_1\parr{1^\secpar; r_\A}
                    \\
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    b &\gets \bit
                    \\
                    \sk\pars{t^*} &\gets \Punct\parr{\sk,t^*}
                    \\
                    c^* &\gets \Enc\parr{\pk,m^b,t^*}
                    \\
                    b' &\gets \A_2\parr{\pk,c^*,\sk\pars{t^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
            \ ,
        \end{bralign}

        \item fully-adaptively indistinguishable under chosen plaintext attack with chosen tag key leakage (ad-IND-CPA/CTKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    \parr{m^0,m^1,t^*} &\gets \A_1\parr{\pk;r_\A}
                    \\
                    b &\gets \bit
                    \\
                    \sk\pars{t^*} &\gets \Punct\parr{\sk,t^*}
                    \\
                    c^* &\gets \Enc\parr{\pk,m^b,t^*}
                    \\
                    b' &\gets \A_2\parr{\pk,c^*,\sk\pars{t^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
            \ ,
        \end{bralign}

        \item fully-adaptively indistinguishable under chosen ciphertext attack with chosen tag key leakage (ad-IND-CCA/CTKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    \parr{m^0,m^1,t^*} &\gets \A_1^{\Dec\parr{\sk,\cdot}}\parr{\pk;r_\A}
                    \\
                    b &\gets \bit
                    \\
                    \sk\pars{t^*} &\gets \Punct\parr{\sk,t^*}
                    \\
                    c^* &\gets \Enc\parr{\pk,m^b,t^*}
                    \\
                    b' &\gets \A_2^{\Dec\parr{\sk,\cdot}}\parr{\pk,c^*,\sk\pars{t^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
        \end{bralign}
        where the decryption oracle outputs \(\bot\) on \(c^*\),
    \end{sitemize}
    for any efficient two-stage adversary \(\A = \parr{\A_1, \A_2}\) and some negligible function \(\negl\).
    We can analogously define variant where only the messages (\(M\)-adaptive) resp.\ only the tag (\(T\)-adaptive) are chosen adaptively.
\end{definition}

\begin{definition}[Ciphertext-Puncturable PKE]
    An \(\parr{\alpha,\alpha_{\textsf{PK}},\varepsilon}\)-ciphertext-puncturable PKE (cpPKE) is a tuple \(\parr{\Gen,\Enc,\Dec,\Punct}\) associated with an admissible message space \(M \coloneqq \parr{M_\secpar}_{\secpar \in \N}\) and
    an admissible randomness space \(R \coloneqq \parr{R_\secpar}_{\secpar \in \N}\) such that
    \begin{sitemize}
        \item \(\Gen\) on input \(1^\secpar\) generates a pair \(\parr{\pk,\sk}\),
        \item \(\Enc\) on input a public key \(\pk\), a message \(m \in M_\secpar\) and a tag \(t \in T_\secpar\) outputs a ciphertext \(c\),
        \item \(\Dec\) on input a secret key \(\sk\) and a ciphertext \(c\) outputs the encrypted message \(m \in M_\secpar \cup \parc{\bot}\),
        \item \(\Punct\) on input a secret key \(\sk\) and a ciphertext \(c'\) outputs a punctured secret key \(\sk\pars{c'}\) that is able to decrypt (almost) all ciphertexts except \(c'\),
    \end{sitemize}
    For each security parameter \(\secpar \in \N\),
    each message \(m \in M_\secpar\) and
    each (possibly malformed) ciphertext \(c'\) we require the following correctness properties:
    \begin{sitemize}
        \item Message correctness:
        \begin{bralign}
            \Pr{
                \parr{\pk,\sk} \gets \Gen\parr{1^\secpar},
                c \gets \Enc\parr{\pk,m}
                :
                \Dec\parr{\sk,c} = m
            }
            \geq 1 - \alpha\parr{\secpar}
        \end{bralign}

        \item Punctured key correctness:
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    c &\gets \Enc\parr{\pk,m}
                    \\
                    \sk\pars{c'} &\gets \Punct\parr{\sk,c'}
                \end{array}
                :
                \Dec\parr{\sk\pars{c'},c} = m
            }
            \geq 1 - \alpha_{\textsf{PK}}\parr{\secpar}
        \end{bralign}
    \end{sitemize}
    Furthermore we say a cpPKE is
    \begin{sitemize}
        \item selectively indistinguishable under chosen plaintext attack with chosen ciphertext key leakage (sel-IND-CPA/CCKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{m^0,m^1} &\coloneqq \A_1\parr{1^\secpar; r_\A}
                    \\
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    b &\gets \bit
                    \\
                    c^* &\gets \Enc\parr{\pk,m^b}
                    \\
                    \sk\pars{c^*} &\gets \Punct\parr{\sk,c^*}
                    \\
                    b' &\gets \A_2\parr{\pk,c^*,\sk\pars{c^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
            \ ,
        \end{bralign}

        \item fully-adaptively indistinguishable under chosen plaintext attack with chosen ciphertext key leakage (ad-IND-CPA/CCKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    \parr{m^0,m^1} &\gets \A_1\parr{\pk;r_\A}
                    \\
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    b &\gets \bit
                    \\
                    c^* &\gets \Enc\parr{\pk,m^b}
                    \\
                    \sk\pars{c^*} &\gets \Punct\parr{\sk,c^*}
                    \\
                    b' &\gets \A_2\parr{\pk,c^*,\sk\pars{c^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
        \end{bralign}

        \item fully-adaptively indistinguishable under chosen ciphertext attack withchosen ciphertext key leakage (ad-IND-CCA/CCKL) iff
        \begin{bralign}
            \Pr{
                \begin{array}{rl}
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    \parr{m^0,m^1} &\gets \A_1^{\Dec\parr{\sk,\cdot}}\parr{\pk;r_\A}
                    \\
                    \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                    \\
                    b &\gets \bit
                    \\
                    c^* &\gets \Enc\parr{\pk,m^b}
                    \\
                    \sk\pars{c^*} &\gets \Punct\parr{\sk,c^*}
                    \\
                    b' &\gets \A_2^{\Dec\parr{\sk,\cdot}}\parr{\pk,c^*,\sk\pars{c^*};r_\A}
                \end{array}
                :
                b' = b
            }
            \leq 1/2 + \varepsilon\parr{\secpar}
        \end{bralign}
        where the decryption oracle outputs \(\bot\) on \(c^*\),
    \end{sitemize}
    for any efficient two-stage adversary \(\A = \parr{\A_1, \A_2}\) and some negligible function \(\negl\).
\end{definition}