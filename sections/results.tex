% !TEX root = ../paper.tex
\section{Technical Overview}
\label{sec:overview}


\subsection{Constructions from Factoring}

\begin{theorem}[Informal]
    If the factoring assumption holds,
    then there exists a sel-IND-CTKL secure tpKEM.
\end{theorem}

\begin{theorem}
    If the \(\varepsilon_{\textsf{IF}}\)-factoring assumption holds,
    then there exists a \(\varepsilon_{\textsf{IND-CTKL}}\)-sel-IND-CTKL secure tpKEM with tag space \(K_\secpar \coloneqq \bit^{\secpar/4}\),
    tag space \(T_\secpar \coloneqq \pars{2^{\secpar/4}}\) where \(\varepsilon_{\textsf{IND-CTKL}}\parr{\secpar} \coloneqq ...\).
\end{theorem}

\begin{proof}
    Let \(L \coloneqq 2^{\secpar/2}\).
    The sel-IND-CTKL PKE scheme is a marginally modified version of the IND-CCA secure KEM of~\textcite{EC:HofKil09}.
    \begin{sitemize}
        \item \(\Gen\parr{1^\secpar}\):
        \begin{sitemize}
            \item sample \(P',Q' \gets \Primes_\secpar\) and set \(N \coloneqq \parr{2P'+1} \parr{2Q'+1}\),
            \item let \(\phi \coloneqq P'Q'\),
            \item sample \(\alpha \gets \pars{\parr{N-1}/4}\),
            \item sample \(g \gets \Q\R_N\),
            \item set \(X \coloneqq g^{\alpha L}\),
            \item set \(\pk \coloneqq \parr{N,g,X}\),
            \item set \(\sk \coloneqq \parr{\pk,\alpha,\phi}\),
            \item output \(\parr{\pk,\sk}\).
        \end{sitemize}
        \item \(\Enc\parr{\pk,t}\):
        \begin{sitemize}
            \item sample \(r \gets \pars{\parr{N-1}/4}\),
            \item set \(R \coloneqq g^{r L}\),
            \item set \(\tau \coloneqq g^{r 2^{\secpar/4}}\),
            \item set \(\kappa \coloneqq \operatorname{BBS}_N\parr{\tau}\),
            % \item set \(t \coloneqq \operatorname{\tau}\parr{R}\),
            \item set \(S \coloneqq \abs{\parr{g^t X}^r}\),
            \item output \(C \coloneqq \parr{t,R,S}\).
        \end{sitemize}
        \item \(\Dec\parr{\sk,C}\):
        \begin{sitemize}
            \item parse \(\parr{t,R,S} \coloneqq C\),
            \item set \(a,b,c\) such that \(\gcd\parr{t,L} = 2^c = a t + b L\),
            \item set \(\tau \coloneqq \parr{S^{2a} R^{2b-2a\alpha}}^{2^{\secpar/4-c-1}}\),
            \item output \(\kappa \coloneqq \operatorname{BBS}_N\parr{\tau}\).
        \end{sitemize}

        \item \(\Punct\parr{\sk,t'}\):
        \begin{sitemize}
            \item set \(\beta \coloneqq \alpha + t'/L \mod \phi\),
            \item output \(\sk\pars{t'} \coloneqq \parr{\pk,\beta,t'}\).
        \end{sitemize}
        \item \(\Dec\parr{\sk[t'],C}\):
        \begin{sitemize}
            \item parse \(\parr{t,R,S} \coloneqq C\),
            \item if \(t = t'\) output \(\bot\),
            \item set \(a',b',c'\) such that \(\gcd\parr{t-t',L} = 2^{c'} = a' \parr{t-t'} + b' L\),
            \item set \(\tau' \coloneqq \parr{S^{2a'} R^{2b'-2a'\beta}}^{2^{\secpar/4-c'-1}}\),
            \item output \(\kappa \coloneqq \operatorname{BBS}_N\parr{\tau'}\).
        \end{sitemize}
    \end{sitemize}
    Statistical message correctness follows directly from the statistical correctness of the original KEM of~\cite{EC:HofKil09}.
    Note here that whether the tag \(t\) is chosen arbitrarily or is the evaluation of a hash function (as in the original KEM) does not affect correctness.
    Now, we prove punctured key correctness for each message \(m\) and each (possibly malformed) \(c\) ciphertext.
    We declare an event \(\textsf{GOOD}\) which we define and analyze later.
    For now, we only need to know that on \(\textsf{GOOD}\) the element \(g\) is a generator of \(\Q\R_N\) and ...
    \marginnote{Write down details of GOOD.}
    We see that
    \begin{bralign}
        &\Pr{
            \begin{array}{rl}
                \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                \\
                c &\gets \Enc\parr{\pk,t}
                \\
                \sk\pars{t'} &\gets \Punct\parr{\sk,t'}
            \end{array}
            :
            \Dec\parr{\sk\pars{t'},c} \neq \Dec\parr{\sk,c}
        }
        \\
        &=
        \Pr{\Dec\parr{\sk\pars{t'},c} \neq \Dec\parr{\sk,c} \wedge \bracket{g} = \Q\R_N}
        +
        \Pr{\Dec\parr{\sk\pars{t'},c} \neq \Dec\parr{\sk,c} \wedge \bracket{g} \neq \Q\R_N}
        \\
        &=
        \Pr{\Dec\parr{\sk\pars{t'},c} \neq \Dec\parr{\sk,c} \wedge \bracket{g} = \Q\R_N}
        +
        \Pr{\bracket{g} \neq \Q\R_N}
        \\
        &\leq
        \Pr{\Dec\parr{\sk\pars{t'},c} \neq \Dec\parr{\sk,c} \given \bracket{g} = \Q\R_N}
        +
        \negl\parr{\secpar}
        \\
        &=
        \Pr{\tau' \neq \tau \given
            \begin{array}{rl}
                \bracket{g} &= \Q\R_N
                \\
                \gcd\parr{t,L} &= 2^c = a t + b L
                \\
                \tau &\coloneqq \parr{S^{2a} R^{2b-2a\alpha}}^{2^{\secpar/4-c-1}}
                \\
                \gcd\parr{t-t',L} &= 2^{c'} = a' \parr{t-t'} + b' L
                \\
                \tau' &\coloneqq \parr{S^{2a'} R^{2b'-2a'\beta}}^{2^{\secpar/4-c'-1}}
            \end{array}
        }
        +
        \negl\parr{\secpar}
        \\
        &=
        \Pr{
            \begin{array}{c}
                \parr{{a'rt+a'\beta rL-a'rt'} + {b'rL-a'\beta rL}} / 2^{c'}
                \\
                \neq
                \parr{{art+a\alpha rL} + {brL-a\alpha rL}} / 2^c
            \end{array}
            \given
            \begin{array}{rl}
                \bracket{g} &= \Q\R_N
                \\
                \gcd\parr{t,L} &= 2^c = a t + b L
                \\
                \gcd\parr{t-t',L} &= 2^{c'} = a' \parr{t-t'} + b' L
            \end{array}
        }
        +
        \negl\parr{\secpar}
        \\
        &=
        \Pr{
            \parr{a'rt-a'rt' + b'rL} / 2^{c'} \neq \parr{art + brL} / 2^c
            \given
            \begin{array}{rl}
                \bracket{g} &= \Q\R_N
                \\
                \gcd\parr{t,L} &= 2^c = a t + b L
                \\
                \gcd\parr{t-t',L} &= 2^{c'} = a' \parr{t-t'} + b' L
            \end{array}
        }
        +
        \negl\parr{\secpar}
        \\
        &=
        \Pr{
            r \neq r
            \given
            \begin{array}{rl}
                \bracket{g} &= \Q\R_N
                \\
                \gcd\parr{t,L} &= 2^c = a t + b L
                \\
                \gcd\parr{t-t',L} &= 2^{c'} = a' \parr{t-t'} + b' L
            \end{array}
        }
        +
        \negl\parr{\secpar}
        \\
        &=
        \negl\parr{\secpar}
    \end{bralign}
    Now, let's prove sel-IND-CTKL security of our scheme.
    \begin{hybrids}
        \item This is the original sel-IND-CTKL with bit \(b = 0\), i.e., the challenge key \(\kappa = \kappa^*\) is the actual key.
        In particular, the challenge ciphertext is \(c^* = \parr{t^*,R^*,S^*}\).

        \item We sample \(\beta \gets \pars{\parr{N-1}/4}\).
        The public key is set as \(X \coloneqq g^{\beta L - t'}\) instead of sampling \(\alpha \gets \pars{\parr{N-1}/4}\) and setting \(X \coloneqq g^{\alpha L}\).
        Note that here we do not need the secret \(\phi\) anymore.
        The distribution of \(X\) is equal in this and the previous hybrid conditioned on \(\textsf{GOOD}\).

        \item We set \(b = 1\), i.e., the challenge key \(\kappa \gets \bit^\secpar\) is a random key.
    \end{hybrids}
\end{proof}


\subsection{Constructions from iO}

\begin{theorem}[Informal]
    Let \(\PKE' = \parr{\Gen',\Enc',\Dec'}\) be a IND-CPA secure PKE.
    Let \(\iO\) be an indistinguishability obfuscator.
    Let \(\NIWI = \parr{\Prove,\Verify}\) be a perfectly sound NIWI.
    Let \(\COM = \parr{\Setup,\Commit,\Open}\) be a perfectly binding commitment scheme.
    Then there exists an ad-IND-CCKL cpPKE \(\PKE\) with binary message space \(M_\secpar \coloneq \parc{0^\secpar,1^\secpar}\).
\end{theorem}

\begin{theorem}
    Let \(\PKE' = \parr{\Gen',\Enc',\Dec'}\) be a prefectly correct \(\varepsilon_{\textsf{IND-CPA}}\)-IND-CPA secure PKE.
    Let \(\iO\) be an \(\varepsilon_{\textsf{iO}}\)-indistinguishable obfuscator.
    Let \(\NIWI = \parr{\Prove,\Verify}\) be a \(\varepsilon_{\textsf{WI}}\)-indistinguishable perfectly sound NIWI.
    Let \(\COM = \parr{\Setup,\Commit,\Open}\) be a \(\varepsilon_{\textsf{hide}}\)-hiding perfectly binding commitment scheme.
    Then there exists an \(\varepsilon_{\textsf{IND-CCKL}}\)-ad-IND-CCKL cpPKE \(\PKE\) with binary message space \(M_\secpar \coloneq \parc{0^\secpar,1^\secpar}\) where \(\varepsilon_{\textsf{IND-CCKL}}\parr{\secpar} \leq 2\varepsilon_{\textsf{hide}}\parr{\secpar} + \varepsilon_{\textsf{WI}}\parr{\secpar} + \varepsilon_{\textsf{iO}}\parr{\secpar} + 2\varepsilon_{\textsf{IND-CPA}}\parr{\secpar}\).
\end{theorem}

\begin{proof}
    W.l.o.g.\ we assume \(m_b \coloneqq b^\secpar\).
    \marginnote{Otherwise we redefine the adversary to flip its output.}
    For simple exhibition we assume that the underlying PKE and obfuscator are perfectly correct and the commitment scheme is perfectly binding.
    For statistical security we would have to add the negligible probability that the generation algorithms \(\Gen'\) and \(\Setup\) output \enquote{faulty} parameters.
    First, we define our ad-IND-CCKL PKE scheme and then prove correctness and security.
    \begin{sitemize}
        \item \(\Gen\parr{1^\secpar}\):
        \begin{sitemize}
            \item sample \(R \gets \bit^{4\secpar+1}\),
            \item generate \(\pp \gets \Setup\parr{1^{\secpar}}\),
            \item generate \(\parr{\pk'_1,\sk'_1}, \parr{\pk'_2,\sk'_2} \gets \Gen'\parr{1^{\secpar}}\),
            \item generate \(C \coloneqq \Commit\parr{\pp,0^{4\secpar+1};R}\),
            \item set \(\pk \coloneqq \parr{\pp,\pk'_1,\pk'_2,C}\) and \(\sk \coloneqq \parr{\pk,\sk'_1}\),
            \item output \(\parr{\pk,\sk}\).
        \end{sitemize}

        \item \(\Enc\parr{\pk,m}\):
        \begin{sitemize}
            \item sample \(r_1,r_2 \gets \bit^\secpar\),
            \item set \(c_1 \coloneqq \Enc'\parr{\pk'_1,m;r_1} \in \bit^{2\secpar}\),
            \item set \(c_2 \coloneqq \Enc'\parr{\pk'_2,m;r_2} \in \bit^{2\secpar}\),
            \item prove \(\pi \gets \Prove\parr{s_{\pk,c_1,c_2},m,r_1,r_2}\) where \(s_{\pk,c_1,c_2}\) is following statement
            \begin{bralign}\label{eq:consistency}
                &\ \parr{
                    \exists m,r_1,r_2 :
                    c_1 = \Enc\parr{\pk'_1,m;r_1}
                    \wedge
                    c_2 = \Enc\parr{\pk'_2,m;r_2}
                }
                \\\label{eq:trapdoor}
                \vee
                &\ \parr{
                    \exists R :
                    C = \Commit\parr{\pp,c_1||c_2||1;R}
                }
                \ ,
            \end{bralign}
            \item output \(c \coloneqq \parr{c_1,c_2,\pi}\),
        \end{sitemize}
        Note that with an honestly generated public key \cref{eq:trapdoor} cannot be fulfilled.

        \item \(\Dec\parr{\sk,c}\):
        \begin{sitemize}
            \item parse \(\parr{c_1,c_2,\pi} \coloneqq c\),
            \item if \(\Verify\parr{s_{\pk,c_1,c_2},\pi} = 0\) output \(\bot\),
            \item output \(\widetilde{m} \coloneqq \Dec'\parr{\sk'_1,c_1}\).
        \end{sitemize}

        \item \(\Punct\parr{\sk, c'}\):
        \begin{sitemize}
            \item parse \(\parr{c'_1,c'_2,\pi'} \coloneqq c'\),
            \item if \(\Verify\parr{s_{\pk,c'_1,c'_2},\pi'} = 0\), return \(\sk\),
            \item output \(\sk\pars{c'} \gets \iO\parr{C_{\sk,c'}}\) where \(C_{\sk,c'}\) is the circuit that on input \(c = \parr{c_1,c_2,\pi}\)
            \begin{sitemize}
                \item if \(\Verify\parr{s_{\pk,c_1,c_2},\pi} = 0\) or \(c_1||c_2 = c'_1||c'_2\), outputs \(\bot\),
                \item outputs \(\widetilde{m} \coloneqq \Dec'\parr{\sk'_1,c_1}\).
            \end{sitemize}
        \end{sitemize}

        \item \(\Dec\parr{\sk\pars{t'},c}\):
        \begin{sitemize}
            \item output \(\sk\pars{t'}\parr{c}\).
        \end{sitemize}
    \end{sitemize}
    Perfect message correctness follows directly from the perfect correctness of \(\PKE'\), \(\NIWI\) and \(\COM\).
    Now, we prove punctured key correctness for each message \(m\) and each (possibly malformed) \(c\) ciphertext.
    Note that if \(c\) is malformed, i.e, verification fails, then \(\sk\pars{c'} = \sk\) and punctured key correctness follows directly from normal message correctness.
    Hence, we consider only wellformed ciphertexts \(c\), i.e., there exists \(m',r'_1,r'_2\) such that \(c'_1 = \Enc\parr{\pk,m';r'_1} \wedge c'_2 = \Enc\parr{\pk,m';r'_2}\).
    We see that
    \begin{bralign}
        &\Pr{
            \begin{array}{rl}
                \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                \\
                c &\gets \Enc\parr{\pk,m}
                \\
                \sk\pars{c'} &\gets \Punct\parr{\sk,c'}
            \end{array}
            :
            \Dec\parr{\sk\pars{c'},c} \neq m
        }
        \\
        &=
        \Pr{c_1||c_2 = c'_1||c'_2}
        \\
        &=
        \Pr{c_1||c_2 = c'_1||c'_2 \wedge m = m'}
        +
        \Pr{c_1||c_2 = c'_1||c'_2 \wedge m \neq m'}
        \marginnote{Perfect correctness of \(\PKE'\)}
        \\
        &=
        \Pr{c_1||c_2 = c'_1||c'_2 \wedge m = m'}
        \\
        &\leq
        \Pr{r_1||r_2 = r'_1||r'_2}
        \\
        &=
        2^{-2\secpar}
    \end{bralign}
    Now, let's prove ad-IND-CCKL security of our scheme.
    \begin{hybrids}
        \item This is the original ad-IND-CCKL with a uniformly random bit \(b \gets \bit\).
        In particular, the challenge ciphertext is \(c^* = \parr{c^*_1,c^*_2,\pi^*}\).

        \item We set \(C \coloneqq \Commit\parr{\pp,c^*_1||c^*_2||1;R}\).
        This step is justified by the (computational) hiding property of the commitment scheme because the randomness \(R\) is only used to generate \(C\).

        \item We prove \(\pi^* \gets \Prove\parr{s_{\pk,,c^*_1,c^*_2},w}\) using as witness \(w \coloneqq R\) instead of \(\parr{m_b,r^*_1,r^*_2}\).
        Note that now \cref{eq:trapdoor} is fulfilled instead of \cref{eq:consistency}.
        This step is justified by the (computational) witness indistinguishability of the NIWI.

        \item We set \(c^*_2 \gets \Enc\parr{\pk'_2,0^{\secpar-1}||1;r^*_2}\) instead of \(\Enc\parr{\pk'_2,m_b;r^*_2}\).
        This step is justified by the (computational) IND-CPA security of the underlying PKE \(\PKE'\) because neither the secret key \(\sk'_2\) nor the randomness \(r^*_2\) are used (except to generate \(c^*_2\)).

        \item We set \(\sk\pars{t^*} \gets \iO\parr{C'_{\sk_2,c^*_1,c^*_2}}\) where \(C'_{\sk_2,c^*_1,c^*_2}\) does the following on input a ciphertext \(c\):
        \begin{sitemize}
            \item parse \(\parr{c_1,c_2,\pi} \coloneqq c\),
            \item if \(\Verify\parr{s_{\pk,c_1,c_2},\pi} = 0\) or \(c_1||c_2 = c^*_1||c^*_2\), output \(\bot\),
            \item output \(\widetilde{m} \coloneqq \Dec'\parr{\sk'_2,c_2}\).
        \end{sitemize}
        Now, \(\sk\pars{t^*}\) contains \(\sk'_2\) but \(\sk'_1\) is no longer used.
        This step is justified by the indistinguishability of \(\iO\) and the functional equivalence of \(C_{\sk_1,k'}\) and \(C'_{\sk_2,c^*_1,c^*_2}\).
        Let us argue in detail why the two circuit are equivalent.
        First, if the verification fails \(\Verify\parr{s_{\pk,c^*_1,c^*_2} = 0}\),
        then both circuits output \(\bot\).
        Thus we can concentrate on inputs (ciphertexts) where the verification passes \(\Verify\parr{s_{\pk,c^*_1,c^*_2} = 1}\).
        Because of the perfect soundness of the NIWI that either \cref{eq:consistency} or \cref{eq:trapdoor} holds but not both because \(c^*_2\) contains \(0^{\secpar-1}||1\) while \(c^*_1\) contains \(m_b = b^\secpar\).
        \begin{sitemize}
            \item If \cref{eq:consistency} holds,
            then (by perfect correctness of \(\PKE'\)) \(c_1\) and \(c_2\) contain the same plaintext \(\widetilde{m}\) and (by negation of \cref{eq:trapdoor}) \(c_1||c_2 \neq c^*_1||c^*_2\).
            Thus, if both circuits output some value \(\widetilde{m} \neq \bot\) it will be the same value (no matter if it is obtained by decrypting \(c_1\) or \(c_2\)).
            \\
            Since \(c_1||c_2 \neq c^*_1||c^*_2\) both circuits output \(\bot\) on the same inputs because their abort conditions are equal.

            \item If \cref{eq:trapdoor} holds, then \(c_1||c_2 = c^*_1||c^*_2\) because the perfectly binding commitment \(C\) contains \(c^*_1||c^*_2||1\).
            In this case the both \(\bot\) because of the abort condition \(c_1||c_2 = c^*_1||c^*_2\).
        \end{sitemize}

        \item We set \(c^*_1 \gets \Enc\parr{\pk'_1,0^{\secpar};r^*_1}\) instead of \(\Enc\parr{\pk'_1,m_b||k^*;r^*_1}\).
        Note that this hybrid is independent of the bit \(b\).
        This step is justified by the (computational) IND-CPA security of the underlying PKE \(\PKE'\) because neither the secret key \(\sk'_1\) nor the randomness \(r^*_1\) are used (except to generate \(c^*_1\)).
    \end{hybrids}
    Let
    \begin{bralign}
        p_i \coloneqq
        \Pr{
            \begin{array}{rl}
                \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                \\
                \parr{m_0,m_1} &\gets \A_1\parr{\pk}
                \\
                b &\gets \bit
                \\
                \parr{\sk\pars{c^*},c^*} &\gets \H_i\parr{\pk,\sk,m_0,m_1}
                \\
                b' &\gets \A_2\parr{\pk,c^*,\sk\pars{t^*}}
            \end{array}
            :
            b' = b
        }
    \end{bralign}
    be the probability that the adversary \(\A\) outputs the correct bit in hybrid \(i\).
    Because \(p_1\) is the adversary's advantage in the original ad-IND-CCKL security game and \(p_6 = 1/2\),
    we see
    \begin{bralign}
        p_1
        &\leq
        \abs{p_1 - p_2} + \abs{p_2 - p_3} + \abs{p_3 - p_4} + \abs{p_4 - p_5} + \abs{p_5 - p_6} + p_6
        \\
        &\leq
        \varepsilon_{\textsf{hide}}\parr{\secpar} + \varepsilon_{\textsf{WI}}\parr{\secpar} + \varepsilon_{\textsf{IND-CPA}}\parr{\secpar} + \varepsilon_{\textsf{iO}}\parr{\secpar} + \varepsilon_{\textsf{IND-CPA}}\parr{\secpar} + 1/2
        \\
        &\leq
        1/2 + \negl\parr{\secpar}
    \end{bralign}

    Note that our scheme only uses obfuscation for the punctured secret key.
\end{proof}

\begin{theorem}
    Let \(\PKE' = \parr{\Gen',\Enc',\Dec',\Punct'}\) be a perfectly correct \(\varepsilon'_{\textsf{IND-CCKL}}\)-ad-IND-CCKL secure cpPKE with binary message space \(M'_\secpar \coloneq \parc{0^\secpar,1^\secpar}\).
    Then there exists an \(\varepsilon_{\textsf{IND-CCKL}}\)-ad-IND-CCKL cpPKE \(\PKE\) with exponentially large message space \(M_\secpar \coloneq \bit^\secpar\) where \(\varepsilon_{\textsf{IND-CCKL}}\parr{\secpar} \leq \secpar \varepsilon'_{\textsf{IND-CCKL}}\parr{\secpar}\).
\end{theorem}

\begin{proof}
    The construction is just a bitwise encryption of the message.
    First, we define our ad-IND-CCKL PKE scheme \(\PKE\) and then prove correctness and security.
    \begin{sitemize}
        \item \(\Gen\parr{1^\secpar}\):
        \begin{sitemize}
            \item generate \(\parr{\pk'_1,\sk'_1}, ..., \parr{\pk'_\secpar,\sk'_\secpar} \gets \Gen'\parr{1^{\secpar}}\),
            \item set \(\pk \coloneqq \parr{\pk'_i,}_{i \in \parc{1,...,\secpar}}\) and \(\sk \coloneqq \parr{\pk,\parr{\sk'_i,}_{i \in \parc{1,...,\secpar}}}\),
            \item output \(\parr{\pk,\sk}\).
        \end{sitemize}

        \item \(\Enc\parr{\pk,m}\):
        \begin{sitemize}
            \item for each \(i \in \parc{1,...,\secpar}\) generate \(c_i \coloneqq \Enc'\parr{\pk'_i,m} \in \bit^{2\secpar}\),
            \item output \(c \coloneqq \parr{c_i}_{i \in \parc{1,...,\secpar}}\),
        \end{sitemize}

        \item \(\Dec\parr{\sk,c}\):
        \begin{sitemize}
            \item parse \(\parr{c_i}_{i \in \parc{1,...,\secpar}} \coloneqq c\),
            \item decrypt \(\widetilde{m}_i \coloneqq \Dec'\parr{\sk'_i,c_i}\),
            \item output \(\widetilde{m} \coloneqq \widetilde{m}_1||...||\widetilde{m}_\secpar\).
        \end{sitemize}

        \item \(\Punct\parr{\sk, c'}\):
        \begin{sitemize}
            \item parse \(\parr{c'_i}_{i \in \parc{1,...,\secpar}} \coloneqq c'\),
            \item puncture \(\sk'_i\pars{c'_i} \coloneqq \Punct'\parr{\sk'_i,c'_i}\),
            \item output \(\sk\pars{c'} \coloneqq \parr{\pk,\parr{\sk'_i\pars{c'_i}}_{i \in \parc{1,...,\secpar}}}\).
        \end{sitemize}

        \item \(\Dec\parr{\sk\pars{c'},c}\):
        \begin{sitemize}
            \item parse \(\parr{c_i}_{i \in \parc{1,...,\secpar}} \coloneqq c\),
            \item decrypt \(\widetilde{m}_i \coloneqq \Dec'\parr{\sk'_i\pars{c'_i},c_i}\),
            \item for any \(i \in \parc{1,...,\secpar}\) if \(\widetilde{m}_i = \bot\) output \(\bot\),
            \item output \(\widetilde{m} \coloneqq \widetilde{m}_1||...||\widetilde{m}_\secpar\).
        \end{sitemize}
    \end{sitemize}
    Perfect message correctness follows directly from the perfect correctness of \(\PKE'\).
    Now, we prove punctured key correctness for each message \(m\) and each (possibly malformed) \(c\) ciphertext.
    Let \(\PKE'\) have at least \(1 - \alpha\parr{\secpar}\) punctured key correctness.
    We see that \(\PKE\) has punctured key correctness
    \begin{bralign}
        &\Pr{
            \begin{array}{rl}
                \parr{\pk,\sk} &\gets \Gen\parr{1^\secpar}
                \\
                c &\gets \Enc\parr{\pk,m}
                \\
                \sk\pars{c'} &\gets \Punct\parr{\sk,c'}
            \end{array}
            :
            \Dec\parr{\sk\pars{c'},c} = m
        }
        \\
        &=
        \Pr{
            \forall i \in \parc{1,...,\secpar} : \Dec'\parr{\sk'_i\pars{c'_i},c_i} = m_i
        }
        \\
        &=
        1
        -
        \Pr{
            \exists i \in \parc{1,...,\secpar} : \Dec'\parr{\sk'_i\pars{c'_i},c_i} \neq m_i
        }
        \\
        &\geq
        1
        -
        \sum_{i=1}^{\secpar} \Pr{
            \Dec'\parr{\sk'_i\pars{c'_i},c_i} \neq m_i
        }
        \\
        &\geq
        1 - \secpar \alpha\parr{\secpar}
        \ .
    \end{bralign}
    Now, let's prove ad-IND-CCKL security of our scheme.
\end{proof}


\begin{theorem}
    Let \(\PKE' = \parr{\Gen',\Enc',\Dec',\Punct'}\) be a prefectly correct \(\varepsilon'_{\textsf{IND-CCKL}}\)-ad-IND-CCKL secure cpPKE.
    Then there exists an \(\varepsilon_{\textsf{IND-CCKL}}\)-ad-IND-CTKL cpPKE \(\PKE\) where \(\varepsilon_{\textsf{IND-CCKL}}\parr{\secpar} \leq \secpar \varepsilon'_{\textsf{IND-CCKL}}\parr{\secpar}\).
\end{theorem}

\begin{proof}
    First, we define our ad-IND-CTKL PKE scheme \(\PKE\) and then prove correctness and security.
    \begin{sitemize}
        \item \(\Gen\parr{1^\secpar}\):
        \begin{sitemize}
            \item generate \(\parr{\pk',\sk'} \gets \Gen'\parr{1^{\secpar}}\),
            \item set \(\pk \coloneqq \pk'\) and \(\sk \coloneqq \sk'\),
            \item output \(\parr{\pk,\sk}\).
        \end{sitemize}

        \item \(\Enc\parr{\pk,m,t}\):
        \begin{sitemize}
            \item decrypt \(c' \coloneqq \Enc'\parr{\pk',m}\),
            \item output \(c \coloneqq \parr{t,c'}\),
        \end{sitemize}

        \item \(\Dec\parr{\sk,c}\):
        \begin{sitemize}
            \item parse \(\parr{t,c'} \coloneqq c\),
            \item output \(\widetilde{m} \coloneqq \Dec'\parr{\sk',c'}\).
        \end{sitemize}

        \item \(\Punct\parr{\sk, t'}\):
        \begin{sitemize}
            \item output \(\sk\pars{t'} \gets \iO\parr{C_{\sk',t'}}\) where \(C_{\sk',t'}\) is the circuit that on input \(c = \parr{t,c'}\)
            \begin{sitemize}
                \item if \(t \neq t'\), outputs \(\bot\),
                \item outputs \(\widetilde{m} \coloneqq \Dec'\parr{\sk',c'}\).
            \end{sitemize}
        \end{sitemize}

        \item \(\Dec\parr{\sk\pars{t'},c}\):
        \begin{sitemize}
            \item output \(\sk\pars{t'}\parr{c}\).
        \end{sitemize}
    \end{sitemize}
    Perfect message correctness follows directly from the perfect correctness of \(\PKE'\).
    Similarly, punctured key correctness follows from the perfect correctness of \(\iO\) and the statistical punctured key correctness of \(\PKE'\).
    Now, let's prove ad-IND-CTKL security of our scheme.
    \begin{hybrids}
        \item This is the original ad-IND-CTKL with bit \(b = 0\).
        In particular, the challenge ciphertext is \(c^* = \parr{t^*,c'^*}\).

        \item We sample \(\beta \gets \pars{\parr{N-1}/4}\).
        The public key is set as \(X \coloneqq g^{\beta L - t'}\) instead of sampling \(\alpha \gets \pars{\parr{N-1}/4}\) and setting \(X \coloneqq g^{\alpha L}\).
        Note that here we do not need the secret \(\phi\) anymore.
        The distribution of \(X\) is equal in this and the previous hybrid conditioned on \(\textsf{GOOD}\).

        \item We set \(b = 1\), i.e., the challenge key \(\kappa \gets \bit^\secpar\) is a random key.
    \end{hybrids}
\end{proof}



\begin{theorem}[Implausibility of perfect punctured key correctness]
    If there is a reduction \(\advR\) from a non-interactive assumption \(\NIA\) to the ad-IND-CCKL security of tpPKE scheme with perfect punctured key correctness,
    then \(\NIA\) does not hold.
    \marginnote{This proof also works for message-selective security.}
\end{theorem}

\begin{proof}
    We give a meta-reduction in the style of \cite{EC:Coron02}.
    Given a challenge \(C\) from the \(\NIA\) challenger,
    the meta-reduction \(\advM\) provides the reduction \(\advR\) with the challenge \(C\).
    Then the reduction \(\advR\) produces a public key \(\pk\).
    The meta-reduction in the role of the ad-IND-CCKL adversary samples two different tags \(t^*_1 \neq t^*_2 \gets T_\secpar\) and provides \(\parr{t^*_1,m_0=0,m_1=1}\) to the reduction \(\advR\).
    The reduction responds with a challenge ciphertext \(c^*_1\) and a punctured secret key \(\sk\pars{c^*_1}\).
    The meta-reduction rewinds the reduction to the point after it produced the public key and provides \(\parr{t^*_2,m_0=0,m_1=1}\) to the reduction \(\advR\).
    The reduction responds with a challenge ciphertext \(c^*_2\) and a punctured secret key \(\sk\pars{c^*_2}\).
    Now the meta-reduction decrypts \(\widetilde{m} \coloneqq \Dec\parr{\sk\pars{t^*_1},c^*_2}\) and feeds \(b' = 1 \iff \widetilde{m} = m_1\) back to the reduction as the solution of the ad-IND-CCKL adversary's challenge.
    The meta-reduction then forwards the reduction's solution to its own \(\NIA\) challenger.
    \marginnote{Analysis...}
\end{proof}

